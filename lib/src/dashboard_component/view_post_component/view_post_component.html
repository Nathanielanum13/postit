<alert [alert]="setAlert" *ngIf="setAlert != null"></alert>
<div class="container mt-3" id="view-app">
    <div class="card shadow-c border-0 bg-transparent {{appTheme['box-one']}} br-20 view-slate">
        <div class="card-body">
            <filter (sendData)="getAllFilterData($event)" [selected]="selectedIds.length"></filter>
            <div class="row mt-2 mx-auto" id="view-box" style="overflow-x: hidden;">
                <div class="table-responsive">
                    <!-- Table -->
                    <table class="table table-hover mb-0">

                        <!-- Table head -->
                        <thead>
                        <tr>
                            <th [class.text-center]="filteredPosts.isEmpty">
                                <material-checkbox [(checked)]="allIsChecked" (click)="getAllIds()"></material-checkbox>
                            </th>
                            <th class="th-lg">Post message</th>
                            <th class="th-lg">Tags </th>
                            <th class="th-lg">Status</th>
                            <th class="th-lg">Created at</th>
                            <th></th>
                        </tr>
                        </thead>
                        <!-- Table head -->
                        <!-- Table body -->
                        <tbody *ngIf="filteredPosts.isNotEmpty">
                            <tr *ngFor="let filteredPost of filteredPosts | slice:(currentPage-1)*conv(itemsPerPage):currentPage*conv(itemsPerPage); let $i=index">
                                <th scope="row">
                                    <material-checkbox [(checked)]="filteredPost.checkedState" (click)="getId($i)"></material-checkbox>
                                </th>
                                <td>
                                    <span class="post-message-text figure-caption">{{filteredPost.postMessage}}</span>
                                </td>
                                <td class="tag-host"><span class="tag tags-text figure-caption" *ngFor="let tag of filteredPost.postTag">{{tag}}</span></td>
                                <td>
                                    <button class="btn btn-outline-success btn-sm br-20 px-4 figure-caption" disabled *ngIf="filteredPost.postStatus">Posted</button>
                                    <button class="btn btn-outline-primary btn-sm br-20 px-4 figure-caption" disabled *ngIf="!filteredPost.postStatus">Pending</button>
                                </td>
                                <td><span class="created-at-text figure-caption">{{filteredPost.createdOn}}</span></td>
                                <td class="text-center">
                                    <div class="nt-circle bg-light shadow--hover add-button cursor-pointer" (click)="togglePopup($i)">
                                        <span class="fa fa-edit font-weight-bold"></span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot *ngIf="filteredPosts.isNotEmpty">
                        <td colspan="6">
                            <ul class="pagination float-right my-auto">
                                <li [class.text-muted]="currentPage == 1">
                                    <a class="nav-link cursor-pointer font-weight-bold" (click)="prevPage()">≪ Prev</a>
                                </li>
                                <li *ngFor="let n of range()"
                                    [class.active]="n == currentPage"
                                    class="nt-circle cursor-pointer"
                                    (click)="setPage(n)">
                                    <span>{{n}}</span>
                                </li>
                                <li [class.text-muted]="currentPage == maxPage">
                                    <a class="nav-link cursor-pointer font-weight-bold" (click)="nextPage()">Next ≫</a>
                                </li>
                            </ul>
                        </td>
                        </tfoot>
                    </table>
                </div>
                <div *ngIf="filteredPosts.isEmpty">
                    <div class="nt-center {{appTheme['text-muted']}} text-center mt-4" style="width: max-content;">
                        <template [ngIf]="!loading">
                            <div class="mb-1">
                                <span class="fa fa-database {{appTheme['text-muted']}} fa-5x drop-fade"></span>
                            </div>
                            <span class="font-weight-bold text-muted fade-in">Nothing to show</span><br>
                            <span class="text-muted figure-caption"><span class="text-muted font-weight-bold fade-in">Suggestions:</span> You can also create:</span> <br>
                            <div class="mt-2">
                                <span class="mx-2 slide-right">
                                    <button class="btn btn-sm btn-outline-dark br-20 px-4" (click)="gotoPosts()">Posts</button>
                                </span>
                                <span class="mx-2 slide-left">
                                    <button class="btn btn-sm btn-outline-dark br-20 px-4" (click)="gotoSchedules()">Schedules</button>
                                </span>
                            </div>
                        </template>
                        <template [ngIf]="loading">
                            <img src="img/load.gif" alt="Loading..." class="img-fluid">
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="nt-circle bg-danger add-button db cursor-pointer shadow" [class.d-none]="selectedIds.isEmpty" [class.opa-7]="selectedIds.isNotEmpty" (click)="batchDelete()">
    <div class="lds-ring" *ngIf="isDeleting"><div></div><div></div><div></div><div></div></div>
    <material-icon icon="delete" class="text-white" *ngIf="!isDeleting"></material-icon>
</div>
<div *ngIf="editPopup" class="popup br-10 p-3 shadow">
    <div class="px-2 py-3 br-10 text-dark bg-light">
        <div class="row w-100 m-0 p-0" *ngIf="tabs[0]">
            <div class="font-weight-bold h5 mb-2 mx-4">Post Message</div>
            <div class="col-10 my-auto">
                <textarea name="message"
                          id="message"
                          cols="30"
                          rows="5"
                          placeholder="Type message here..."
                          class="nt-form-control br-20"
                          [(ngModel)]="message"
                          #el
                          (input)="getInputSelection(el)"
                          (click)="getInputSelection(el)"
                          (keyup)="getInputSelection(el)"></textarea>
                <div class="row mx-0 mt-3 p-0">
                    <span class="br-20 px-3 py-1 special-btn mr-3 cursor-pointer font-weight-bold text-muted" (click)="switchTabs(1)">
                        <span class="fa fa-hashtag mr-1"></span>Tags
                    </span>
                    <span class="br-20 px-3 py-1 special-btn cursor-pointer font-weight-bold text-muted" (click)="switchTabs(2)">
                        <span class="fa fa-file-picture-o text-success mr-1"></span>Photos
                    </span>
                </div>
                <div class="row m-0 p-0">
                    <div id="emoji-container" class="br-20 bg-white shadow" *ngIf="displayEmojiContainer">
                        <emoji-app (myClick)="setData($event)"></emoji-app>
                    </div>
                </div>
            </div>
            <div class="col-2 text-center">
                <span class="fa fa-2x fa-smile-o cursor-pointer text-warning" (click)="toggleEmojiContainer()"></span>
            </div>
        </div>
        <div class="row w-100 m-0 p-0" *ngIf="tabs[1]">
            <div class="font-weight-bold h5 mb-2 mx-auto">Post Tags</div>
            <div class="col-12 my-auto">
                <form action="" novalidate>
                    <div class="form-group">
                        <input (keyup.enter)="addTag()" [(ngModel)]="hashtag"
                               class="nt-form-control br-20"
                               id="hash" placeholder="Hash tags ..."
                               type="text">
                    </div>
                </form>
                <div class="row">
                    <div class="col-12 tag-container mx-0 px-2 c-bordered br-10">
                        <material-chips *ngIf="postTags.isNotEmpty">
                            <material-chip (remove)="removeTag($i)"
                                           *ngFor="let postTag of postTags; let $i = index"
                                           [value]="postTag" class="col-auto">
                                {{postTag}}
                            </material-chip>
                        </material-chips>
                        <div class="nt-center text-muted font-weight-bold" *ngIf="postTags.isEmpty">
                            + Add some tags here
                        </div>
                    </div>
                </div>
                <div class="row mx-0 mt-3 p-0">
                    <span class="br-20 px-3 py-1 special-btn mr-3 cursor-pointer font-weight-bold text-muted" (click)="switchTabs(0)">
                        <span class="fa fa-envelope mr-1"></span>Post
                    </span>
                    <span class="br-20 px-3 py-1 special-btn cursor-pointer font-weight-bold text-muted" (click)="switchTabs(2)">
                        <span class="fa fa-file-picture-o text-success mr-1"></span>Photos
                    </span>
                </div>
            </div>
        </div>
        <div class="row w-100 m-0 p-0" *ngIf="tabs[2]">
            <div class="font-weight-bold h5 mb-2 mx-auto">Post Image</div>
            <div class="col-12 my-auto">
                <div class="m-0 p-2" id="image-holder">
                    <image-app></image-app>
                </div>
                <div class="row mx-0 mt-3 p-0">
                    <span class="br-20 px-3 py-1 special-btn mr-3 cursor-pointer font-weight-bold text-muted" (click)="switchTabs(1)">
                        <span class="fa fa-hashtag mr-1"></span>Tags
                    </span>
                    <span class="br-20 px-3 py-1 special-btn mr-3 cursor-pointer font-weight-bold text-muted" (click)="switchTabs(0)">
                        <span class="fa fa-envelope mr-1"></span>Post
                    </span>
                </div>
            </div>
        </div>
        <div class="mt-3 p-0 text-right">
            <button class="btn btn-sm btn-success br-20 px-4 mr-2" (click)="updatePost()"> <span class="fa fa-edit mr-1"></span>Save</button>
            <button class="btn btn-sm btn-light br-20 px-4" (click)="closePopup()">Cancel</button>
        </div>
    </div>
</div>